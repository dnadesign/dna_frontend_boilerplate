#!/usr/bin/env php
<?php

$op = true;
if (isset($_SERVER['argv'][1])) {
	$op = $_SERVER['argv'][1];
}

$pwd = $_SERVER['PWD'];
$assets = dirname(dirname(realpath($_SERVER['argv'][0]))) .'/assets';

$setupFiles = array(
	'.bowerrc',
	'bower.json',
	'Gruntfile.js',
	'package.json',
	'Makefile'
);

$setupFolders = array(
	'build',
	'images'
	'dist'
);

$bower = array(
	'jquery',
	'bootstrap',
	'radio',
	'modernizer'
);

function recurse_copy($src,$dst) { 
    $dir = opendir($src); 
    @mkdir($dst); 
    while(false !== ( $file = readdir($dir)) ) { 
        if (( $file != '.' ) && ( $file != '..' )) { 
            if ( is_dir($src . '/' . $file) ) { 
                recurse_copy($src . '/' . $file,$dst . '/' . $file); 
            } 
            else { 
                copy($src . '/' . $file,$dst . '/' . $file); 
            } 
        } 
    } 
    closedir($dir); 
} 

function installComponent($name) {
	
}

switch($op) {
	case 'setup':
		foreach($setupFiles as $file) {
			if(!file_exists($pwd .'/'. $file)) {
				echo "Writing $file\n";
				file_put_contents(
					$pwd .'/'. $file,
					file_get_contents($assets .'/'. $file)
				);
			}
		}

		foreach($setupFolders as $folder) {
			echo "Creating $folder/\n";

			if(!file_exists($pwd.'/'.$folder)) {
				mkdir($pwd.'/'. $folder);
			}
		}

		echo "\nSetting up NPM\n";
		exec("npm install --silent");

		echo "\nInstalling bower\n";
		exec("npm install -g bower &>/dev/null");

		echo "\nSetting up bower\n";
		exec("bower install");

		echo "\nSetting up modernizr\n";
		exec("grunt modernizr");

		echo "\nInstalling "

		foreach($bower as $dependancy) {
			exec("bower install $dependancy");
		}

		echo "\nImporting global\n";
		installComponent('forms');
		installComponent('type');
		installComponent('layout');
	break;
	case 'create':
		if(isset($_SERVER['argv'][2])) {
			$folder = $_SERVER['argv'][2];
			if(!file_exists($pwd.'/build/components')) {
				mkdir($pwd.'/build/components');
			}
			echo "Creating $folder";
			$path = $pwd.'/build/components/'.$folder;

			if(!file_exists($path)) {
				mkdir($path);
			}
		} else {
			echo "Please provide a component name";
		}
	break;
	case 'remove':
		if(isset($_SERVER['argv'][2])) {
			$folder = $_SERVER['argv'][2];
			echo "Removing $folder";
			$path = $pwd.'/build/components/'.$folder;

			if(file_exists($path)) {
				rmdir($path);
			}

		} else {
			echo "Please provide a component name";
		}
	break;
	default:
		echo "helix [setup|create|install|remove]";
}